<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate survey design weight within a NHANES dataset — create_design • nhanesdata</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate survey design weight within a NHANES dataset — create_design"><meta name="description" content="Input an NHANES dataset and apply the proper weight calculation. There are 3
categories of weights:
Interview weight
Mobile Exam Center (MEC) weight
Fasting weight
The probability of being sampled for each type of NHANES category decreases from
interview to fasting samples. Therefore, when selecting the proper weight, the
practitioner should use the weight with the lowest probability when combining variables
across categories. For example, when performing an analysis using demographics
(interview), diabetes information (interview), and DEXA scanning (MEC), the
associated MEC weight is the proper weight variable to use.
It is also important to select the proper year grouping for the cycle. NHANES cycles
for 1999 and 2001 use 4-year sample weights, while all subsequent cycles use 2-year
sample weights. This type of combination requires careful attention to:
The variables used, to determine weight category (interview, MEC, fasting).
The cycles (years) used, to select proper year grouping variable.


This function will allow the user to input a dataset, select analysis start &amp;amp; end
years, and specify the type of weight category. The resulting survey design will
calculate the proper weight and apply that when creating the design object.
NOTE: It is not required to specify variables for this function and it is
highly recommended to perform preprocessing of variables before
creating a complex design object.
See also as_survey_design"><meta property="og:description" content="Input an NHANES dataset and apply the proper weight calculation. There are 3
categories of weights:
Interview weight
Mobile Exam Center (MEC) weight
Fasting weight
The probability of being sampled for each type of NHANES category decreases from
interview to fasting samples. Therefore, when selecting the proper weight, the
practitioner should use the weight with the lowest probability when combining variables
across categories. For example, when performing an analysis using demographics
(interview), diabetes information (interview), and DEXA scanning (MEC), the
associated MEC weight is the proper weight variable to use.
It is also important to select the proper year grouping for the cycle. NHANES cycles
for 1999 and 2001 use 4-year sample weights, while all subsequent cycles use 2-year
sample weights. This type of combination requires careful attention to:
The variables used, to determine weight category (interview, MEC, fasting).
The cycles (years) used, to select proper year grouping variable.


This function will allow the user to input a dataset, select analysis start &amp;amp; end
years, and specify the type of weight category. The resulting survey design will
calculate the proper weight and apply that when creating the design object.
NOTE: It is not required to specify variables for this function and it is
highly recommended to perform preprocessing of variables before
creating a complex design object.
See also as_survey_design"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nhanesdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/the-datasets.html">Dataset Catalog</a></li>
    <li><a class="dropdown-item" href="../articles/survey-design.html">Survey Design Objects</a></li>
    <li><a class="dropdown-item" href="../articles/covid-data-exclusion.html">COVID-19 Data Exclusion</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kyleGrealis/nhanesdata" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate survey design weight within a NHANES dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/kyleGrealis/nhanesdata/blob/HEAD/R/create_design.R" class="external-link"><code>R/create_design.R</code></a></small>
      <div class="d-none name"><code>create_design.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Input an NHANES dataset and apply the proper weight calculation. There are 3
categories of weights:</p><ol><li><p>Interview weight</p></li>
<li><p>Mobile Exam Center (MEC) weight</p></li>
<li><p>Fasting weight</p></li>
</ol><p>The probability of being sampled for each type of NHANES category decreases from
interview to fasting samples. Therefore, when selecting the proper weight, the
practitioner should use the weight with the lowest probability when combining variables
across categories. For example, when performing an analysis using demographics
(interview), diabetes information (interview), and DEXA scanning (MEC), the
associated MEC weight is the proper weight variable to use.</p>
<p>It is also important to select the proper year grouping for the cycle. NHANES cycles
for 1999 and 2001 use 4-year sample weights, while all subsequent cycles use 2-year
sample weights. This type of combination requires careful attention to:</p><ol><li><p>The variables used, to determine weight category (interview, MEC, fasting).</p></li>
<li><p>The cycles (years) used, to select proper year grouping variable.</p></li>
</ol><p>This function will allow the user to input a dataset, select analysis start &amp; end
years, and specify the type of weight category. The resulting survey design will
calculate the proper weight and apply that when creating the design object.</p>
<p>NOTE: It is <strong>not</strong> required to specify variables for this function and it is
<strong>highly recommended</strong> to perform preprocessing of variables <em>before</em>
creating a complex design object.</p>
<p>See also <code><a href="http://gdfe.co/srvyr/reference/as_survey_design.html" class="external-link">as_survey_design</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_design</span><span class="op">(</span></span>
<span>  <span class="va">dsn</span>,</span>
<span>  <span class="va">start_yr</span>,</span>
<span>  <span class="va">end_yr</span>,</span>
<span>  wt_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"interview"</span>, <span class="st">"mec"</span>, <span class="st">"fasting"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dsn">dsn<a class="anchor" aria-label="anchor" href="#arg-dsn"></a></dt>
<dd><p>Tibble or data-frame.</p></dd>


<dt id="arg-start-yr">start_yr<a class="anchor" aria-label="anchor" href="#arg-start-yr"></a></dt>
<dd><p>Numeric. Lower bound for year filtering (inclusive).
Must be an odd year representing a valid NHANES cycle start: 1999, 2001,
2003, ..., 2019, 2021. For example, use 2007 for the 2007-2008 cycle.
Data will be filtered to include years between start_yr and end_yr.</p></dd>


<dt id="arg-end-yr">end_yr<a class="anchor" aria-label="anchor" href="#arg-end-yr"></a></dt>
<dd><p>Numeric. Upper bound for year filtering (inclusive).
Must be an odd year &gt;= start_yr. Weight calculations are based on the
number of cycles actually present in the filtered data, so it is valid
to have gaps (e.g., start_yr=1999, end_yr=2017 with 2007-2010 missing).</p></dd>


<dt id="arg-wt-type">wt_type<a class="anchor" aria-label="anchor" href="#arg-wt-type"></a></dt>
<dd><p>Character. Category of weight to be used. Use the weight category with
the lowest probability of selection, but only if at least one variable from that
category is to be used. Accepts full names (<code>"interview"</code>, <code>"mec"</code>,
<code>"fasting"</code>) or abbreviations (<code>"int"</code>, <code>"mec"</code>, <code>"fast"</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A survey design object of class <code>tbl_svy</code> (from srvyr package)
containing the calculated design weights and survey design metadata (PSUs,
strata). Participants without valid weights for the specified weight type
are automatically filtered out before design object creation. Participants
with zero weights are retained in the design object but will be automatically
excluded from most survey analyses.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Weight Calculation for Combined Cycles</strong></p>
<p>NHANES provides 4-year weights for the 1999-2000 and 2001-2002 cycles, while all
subsequent cycles provide only 2-year weights. When combining multiple cycles:</p><ul><li><p>If 1999 or 2001 cycles are included: Use the 4-year weight variable multiplied by
<code>2/n</code> where <code>n</code> is the total number of cycles. The numerator is 2 because
the 4-year weight represents two 2-year cycles.</p></li>
<li><p>For cycles 2003 and beyond: Use the 2-year weight variable multiplied by <code>1/n</code>.</p></li>
<li><p>The denominator <code>n</code> is always the total number of cycles in the analysis.</p></li>
</ul><p>Example: Combining 4 cycles (1999, 2001, 2003, 2005):</p><ul><li><p>1999 &amp; 2001: <code>wtmec4yr * 2/4</code></p></li>
<li><p>2003 &amp; 2005: <code>wtmec2yr * 1/4</code></p></li>
</ul><p>Fasting weights (<code>wtsaf2yr</code>) are used with <code>1/n</code> multiplication.</p>
<p>NOTE: 4-year fasting weights (<code>wtsaf4yr</code>) exist in NHANES laboratory files
for 1999-2002 but are not currently supported by this function.</p>
<p><strong>Fasting Subsample Weights</strong></p>
<p>For fasting subsample analyses combining 1999-2002 cycles, the 4-year fasting
weight (WTSAF4YR) exists in laboratory files (e.g., LAB10AM, LAB13AM) but is
typically NOT in demographic files obtained via nhanesA. If your dataset includes
merged laboratory fasting data from 1999-2002, ensure WTSAF4YR is present.
Otherwise, this function assumes only 2-year fasting weights (WTSAF2YR) are available.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Load demographics data</span></span></span>
<span class="r-in"><span><span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_nhanes.html">read_nhanes</a></span><span class="op">(</span><span class="st">"demo"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading: DEMO</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DEMO complete! (113,249 rows)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create design object with interview weights</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">create_design</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dsn <span class="op">=</span> <span class="va">demo</span>,</span></span>
<span class="r-in"><span>  start_yr <span class="op">=</span> <span class="fl">1999</span>,</span></span>
<span class="r-in"><span>  end_yr <span class="op">=</span> <span class="fl">2011</span>,</span></span>
<span class="r-in"><span>  wt_type <span class="op">=</span> <span class="st">"interview"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combine with examination data and use MEC weights</span></span></span>
<span class="r-in"><span><span class="va">bmx</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_nhanes.html">read_nhanes</a></span><span class="op">(</span><span class="st">"bmx"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading: BMX</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> BMX complete! (96,288 rows)</span>
<span class="r-in"><span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">demo</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bmx</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seqn"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">design_mec</span> <span class="op">&lt;-</span> <span class="fu">create_design</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dsn <span class="op">=</span> <span class="va">combined</span>,</span></span>
<span class="r-in"><span>  start_yr <span class="op">=</span> <span class="fl">2007</span>,</span></span>
<span class="r-in"><span>  end_yr <span class="op">=</span> <span class="fl">2017</span>,</span></span>
<span class="r-in"><span>  wt_type <span class="op">=</span> <span class="st">"mec"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Note: 2428 participants have zero mec weights and will be retained in the</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> design object.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> These participants were not in the subsample for this weight category</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> and will be automatically excluded from analyses by the {survey} package.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.kylegrealis.com" class="external-link">Kyle Grealis</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

